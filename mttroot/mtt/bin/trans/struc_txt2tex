#! /bin/sh

     ###################################### 
     ##### Model Transformation Tools #####
     ######################################

# Bourne shell script: struc_txt2tex

# Stucture file - text to TeX table conversion
# P.J.Gawthrop April 1997
# Copyright (c) P.J.Gawthrop, 1997.

###############################################################
## Version control history
###############################################################
## $Id$
## $Log$
# Revision 1.1  1997/04/15  09:49:04  peterg
# Initial revision
#
###############################################################


# Inform user
echo "Creating $1_struc.tex"

rm -f mtt_error

#Write some file headers
echo "%% Structure file ($1_struc.txt)" > $1_struc.tex
echo "%% Generated by MTT at `date`" >> $1_struc.tex

# This is the main transformation using gawk
sed 's/_/\\_/g' < $1_struc.txt |  gawk '
function header(what){
#  print "\\begin{table}[htbp]";
  print "  \\centering";
  print "  \\bottomcaption{" what "}";
  print "  \\begin{supertabular}{|l|l|l|l|}";
  print "    \\hline";
  print "    Index & Component & System & Repetition \\\\";
  print "    \\hline";
}

function footer(what){
  print "    \\hline";
  print "  \\end{supertabular}";
#  print "  \\caption{" what "}";
#  print "\\end{table}";
  print "   \\bigskip";
  print "   \\bigskip";
}

BEGIN{
Which=""
}
{
  if ($1!=Which) {
    if (Which!="") footer(Which);
    header($1);
  }
  print $2, "&", $3,"&", $4, "&", $5, "\\\\";
  Which = $1;
}
END{
  footer(Which)
}
'  >> $1_struc.tex 2>mtt_error.txt

# Now invoke the standard error handling.
#mtt_error mtt_error.txt


